import fs from 'fs-extra'
import { defineBuildConfig } from 'unbuild'

const manifest = JSON.parse(fs.readFileSync('./dist/styleguide-assets/.vite/manifest.json', 'utf-8'))

const hashedFileNames = {
  'fullpage.js': manifest['client/fullpage.ts'].file,
  'client.js': manifest['client/main.ts'].file,
  'style.css': manifest['style.css'].file,
} as const

const shikiExternalPackages = [
  'shiki',
  '@shikijs/engine-javascript',
  '@shikijs/engine-oniguruma',
  '@shikijs/core',
  'shiki/wasm',
  '@shikijs/langs/abap',
  '@shikijs/langs/actionscript-3',
  '@shikijs/langs/ada',
  '@shikijs/langs/angular-html',
  '@shikijs/langs/angular-ts',
  '@shikijs/langs/apache',
  '@shikijs/langs/apex',
  '@shikijs/langs/apl',
  '@shikijs/langs/applescript',
  '@shikijs/langs/ara',
  '@shikijs/langs/asciidoc',
  '@shikijs/langs/asm',
  '@shikijs/langs/astro',
  '@shikijs/langs/awk',
  '@shikijs/langs/ballerina',
  '@shikijs/langs/bat',
  '@shikijs/langs/beancount',
  '@shikijs/langs/berry',
  '@shikijs/langs/bibtex',
  '@shikijs/langs/bicep',
  '@shikijs/langs/blade',
  '@shikijs/langs/bsl',
  '@shikijs/langs/c',
  '@shikijs/langs/cadence',
  '@shikijs/langs/cairo',
  '@shikijs/langs/clarity',
  '@shikijs/langs/clojure',
  '@shikijs/langs/cmake',
  '@shikijs/langs/cobol',
  '@shikijs/langs/codeowners',
  '@shikijs/langs/codeql',
  '@shikijs/langs/coffee',
  '@shikijs/langs/common-lisp',
  '@shikijs/langs/coq',
  '@shikijs/langs/cpp',
  '@shikijs/langs/crystal',
  '@shikijs/langs/csharp',
  '@shikijs/langs/css',
  '@shikijs/langs/csv',
  '@shikijs/langs/cue',
  '@shikijs/langs/cypher',
  '@shikijs/langs/d',
  '@shikijs/langs/dart',
  '@shikijs/langs/dax',
  '@shikijs/langs/desktop',
  '@shikijs/langs/diff',
  '@shikijs/langs/docker',
  '@shikijs/langs/dotenv',
  '@shikijs/langs/dream-maker',
  '@shikijs/langs/edge',
  '@shikijs/langs/elixir',
  '@shikijs/langs/elm',
  '@shikijs/langs/emacs-lisp',
  '@shikijs/langs/erb',
  '@shikijs/langs/erlang',
  '@shikijs/langs/fennel',
  '@shikijs/langs/fish',
  '@shikijs/langs/fluent',
  '@shikijs/langs/fortran-fixed-form',
  '@shikijs/langs/fortran-free-form',
  '@shikijs/langs/fsharp',
  '@shikijs/langs/gdresource',
  '@shikijs/langs/gdscript',
  '@shikijs/langs/gdshader',
  '@shikijs/langs/genie',
  '@shikijs/langs/gherkin',
  '@shikijs/langs/git-commit',
  '@shikijs/langs/git-rebase',
  '@shikijs/langs/gleam',
  '@shikijs/langs/glimmer-js',
  '@shikijs/langs/glimmer-ts',
  '@shikijs/langs/glsl',
  '@shikijs/langs/gnuplot',
  '@shikijs/langs/go',
  '@shikijs/langs/graphql',
  '@shikijs/langs/groovy',
  '@shikijs/langs/hack',
  '@shikijs/langs/haml',
  '@shikijs/langs/handlebars',
  '@shikijs/langs/haskell',
  '@shikijs/langs/haxe',
  '@shikijs/langs/hcl',
  '@shikijs/langs/hjson',
  '@shikijs/langs/hlsl',
  '@shikijs/langs/html',
  '@shikijs/langs/html-derivative',
  '@shikijs/langs/http',
  '@shikijs/langs/hxml',
  '@shikijs/langs/hy',
  '@shikijs/langs/imba',
  '@shikijs/langs/ini',
  '@shikijs/langs/java',
  '@shikijs/langs/javascript',
  '@shikijs/langs/jinja',
  '@shikijs/langs/jison',
  '@shikijs/langs/json',
  '@shikijs/langs/json5',
  '@shikijs/langs/jsonc',
  '@shikijs/langs/jsonl',
  '@shikijs/langs/jsonnet',
  '@shikijs/langs/jssm',
  '@shikijs/langs/jsx',
  '@shikijs/langs/julia',
  '@shikijs/langs/kotlin',
  '@shikijs/langs/kusto',
  '@shikijs/langs/latex',
  '@shikijs/langs/lean',
  '@shikijs/langs/less',
  '@shikijs/langs/liquid',
  '@shikijs/langs/log',
  '@shikijs/langs/logo',
  '@shikijs/langs/lua',
  '@shikijs/langs/luau',
  '@shikijs/langs/make',
  '@shikijs/langs/markdown',
  '@shikijs/langs/marko',
  '@shikijs/langs/matlab',
  '@shikijs/langs/mdc',
  '@shikijs/langs/mdx',
  '@shikijs/langs/mermaid',
  '@shikijs/langs/mipsasm',
  '@shikijs/langs/mojo',
  '@shikijs/langs/move',
  '@shikijs/langs/narrat',
  '@shikijs/langs/nextflow',
  '@shikijs/langs/nginx',
  '@shikijs/langs/nim',
  '@shikijs/langs/nix',
  '@shikijs/langs/nushell',
  '@shikijs/langs/objective-c',
  '@shikijs/langs/objective-cpp',
  '@shikijs/langs/ocaml',
  '@shikijs/langs/pascal',
  '@shikijs/langs/perl',
  '@shikijs/langs/php',
  '@shikijs/langs/plsql',
  '@shikijs/langs/po',
  '@shikijs/langs/polar',
  '@shikijs/langs/postcss',
  '@shikijs/langs/powerquery',
  '@shikijs/langs/powershell',
  '@shikijs/langs/prisma',
  '@shikijs/langs/prolog',
  '@shikijs/langs/proto',
  '@shikijs/langs/pug',
  '@shikijs/langs/puppet',
  '@shikijs/langs/purescript',
  '@shikijs/langs/python',
  '@shikijs/langs/qml',
  '@shikijs/langs/qmldir',
  '@shikijs/langs/qss',
  '@shikijs/langs/r',
  '@shikijs/langs/racket',
  '@shikijs/langs/raku',
  '@shikijs/langs/razor',
  '@shikijs/langs/reg',
  '@shikijs/langs/regexp',
  '@shikijs/langs/rel',
  '@shikijs/langs/riscv',
  '@shikijs/langs/rst',
  '@shikijs/langs/ruby',
  '@shikijs/langs/rust',
  '@shikijs/langs/sas',
  '@shikijs/langs/sass',
  '@shikijs/langs/scala',
  '@shikijs/langs/scheme',
  '@shikijs/langs/scss',
  '@shikijs/langs/sdbl',
  '@shikijs/langs/shaderlab',
  '@shikijs/langs/shellscript',
  '@shikijs/langs/shellsession',
  '@shikijs/langs/smalltalk',
  '@shikijs/langs/solidity',
  '@shikijs/langs/soy',
  '@shikijs/langs/sparql',
  '@shikijs/langs/splunk',
  '@shikijs/langs/sql',
  '@shikijs/langs/ssh-config',
  '@shikijs/langs/stata',
  '@shikijs/langs/stylus',
  '@shikijs/langs/svelte',
  '@shikijs/langs/swift',
  '@shikijs/langs/system-verilog',
  '@shikijs/langs/systemd',
  '@shikijs/langs/talonscript',
  '@shikijs/langs/tasl',
  '@shikijs/langs/tcl',
  '@shikijs/langs/templ',
  '@shikijs/langs/terraform',
  '@shikijs/langs/tex',
  '@shikijs/langs/toml',
  '@shikijs/langs/ts-tags',
  '@shikijs/langs/tsv',
  '@shikijs/langs/tsx',
  '@shikijs/langs/turtle',
  '@shikijs/langs/twig',
  '@shikijs/langs/typescript',
  '@shikijs/langs/typespec',
  '@shikijs/langs/typst',
  '@shikijs/langs/v',
  '@shikijs/langs/vala',
  '@shikijs/langs/vb',
  '@shikijs/langs/verilog',
  '@shikijs/langs/vhdl',
  '@shikijs/langs/viml',
  '@shikijs/langs/vue',
  '@shikijs/langs/vue-html',
  '@shikijs/langs/vyper',
  '@shikijs/langs/wasm',
  '@shikijs/langs/wenyan',
  '@shikijs/langs/wgsl',
  '@shikijs/langs/wikitext',
  '@shikijs/langs/wolfram',
  '@shikijs/langs/xml',
  '@shikijs/langs/xsl',
  '@shikijs/langs/yaml',
  '@shikijs/langs/zenscript',
  '@shikijs/langs/zig',
  '@shikijs/themes/andromeeda',
  '@shikijs/themes/aurora-x',
  '@shikijs/themes/ayu-dark',
  '@shikijs/themes/catppuccin-frappe',
  '@shikijs/themes/catppuccin-latte',
  '@shikijs/themes/catppuccin-macchiato',
  '@shikijs/themes/catppuccin-mocha',
  '@shikijs/themes/dark-plus',
  '@shikijs/themes/dracula',
  '@shikijs/themes/dracula-soft',
  '@shikijs/themes/everforest-dark',
  '@shikijs/themes/everforest-light',
  '@shikijs/themes/github-dark',
  '@shikijs/themes/github-dark-default',
  '@shikijs/themes/github-dark-dimmed',
  '@shikijs/themes/github-dark-high-contrast',
  '@shikijs/themes/github-light',
  '@shikijs/themes/github-light-default',
  '@shikijs/themes/github-light-high-contrast',
  '@shikijs/themes/houston',
  '@shikijs/themes/kanagawa-dragon',
  '@shikijs/themes/kanagawa-lotus',
  '@shikijs/themes/kanagawa-wave',
  '@shikijs/themes/laserwave',
  '@shikijs/themes/light-plus',
  '@shikijs/themes/material-theme',
  '@shikijs/themes/material-theme-darker',
  '@shikijs/themes/material-theme-lighter',
  '@shikijs/themes/material-theme-ocean',
  '@shikijs/themes/material-theme-palenight',
  '@shikijs/themes/min-dark',
  '@shikijs/themes/min-light',
  '@shikijs/themes/monokai',
  '@shikijs/themes/night-owl',
  '@shikijs/themes/nord',
  '@shikijs/themes/one-dark-pro',
  '@shikijs/themes/one-light',
  '@shikijs/themes/plastic',
  '@shikijs/themes/poimandres',
  '@shikijs/themes/red',
  '@shikijs/themes/rose-pine',
  '@shikijs/themes/rose-pine-dawn',
  '@shikijs/themes/rose-pine-moon',
  '@shikijs/themes/slack-dark',
  '@shikijs/themes/slack-ochin',
  '@shikijs/themes/snazzy-light',
  '@shikijs/themes/solarized-dark',
  '@shikijs/themes/solarized-light',
  '@shikijs/themes/synthwave-84',
  '@shikijs/themes/tokyo-night',
  '@shikijs/themes/vesper',
  '@shikijs/themes/vitesse-black',
  '@shikijs/themes/vitesse-dark',
  '@shikijs/themes/vitesse-light',
  'oniguruma-to-es',
  '@shikijs/types',
  '@shikijs/vscode-textmate',
  'hast-util-to-html',
  '@shikijs/engine-oniguruma/wasm-inlined',
  'emoji-regex-xs',
  'regex/internals',
  'regex-recursion',
  'html-void-elements',
  'property-information',
  'regex-utilities',
  'zwitch',
  'stringify-entities',
  'ccount',
  'comma-separated-tokens',
  'space-separated-tokens',
  'hast-util-whitespace',
  'character-entities-legacy',
  'character-entities-html4',
]

export default defineBuildConfig({
  outDir: 'dist/node',
  entries: ['./lib/index', './lib/vite-pug/worker'],
  declaration: true,
  failOnWarn: false,
  externals: ['@antfu/utils', ...shikiExternalPackages],
  replace: {
    __STYLEGUIDE_CSS__: hashedFileNames['style.css'],
    __STYLEGUIDE_CLIENT_JS__: hashedFileNames['client.js'],
    __STYLEGUIDE_FULLPAGE_JS__: hashedFileNames['fullpage.js'],
  },
})
